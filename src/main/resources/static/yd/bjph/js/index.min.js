$(function(){function n(t){for(var n=window.location.search.substring(1).split("&"),o=0;o<n.length;o++){var e=n[o].split("=");if(e[0]==t)return e[1]}return!1}var o="http://www.zpffz.com",e=$("#msg-puop")[0],r=$(".get-code"),i=$("#phone-number")[0],s=$("#vef-code")[0],c=$(".btn-sbumit"),a=$(".modal"),u=$(".modal").find(".close"),f=$("#confirm"),h={X:0,y:0,A:0};function l(){this.checkInfo=[],this.wran=[]}l.prototype.strategies={noEmpty:function(t,n){return""!==t||n},isMobile:function(t,n){return!!/^1[3456789]\d{9}$/.test(t)||n}},l.prototype.add=function(r,i,t){var s=this;this.wran.push(i),t.forEach(function(e){s.checkInfo.push(function(){var t=e.strategy.split(":"),n=t.shift();t.unshift(r.value),t.push(e.error);var o=s.strategies[n].apply(s,t);return console.log("msg",o),!0!==o&&d.show(i,o),o})})};var p={isNot:!(l.prototype.check=function(){var t=!0;this.wran.forEach(function(t){t.innerText=""});for(var n=0;n<this.checkInfo.length;n++)if(!0!==this.checkInfo[n]())return t=!1;return t}),countTimer:0,countDown:function(t){this.isNot=!0,this.countTimer=setInterval(function(){--t<=0?this.clearCountTimer():r.text("重新获取("+t+")s")},1e3)},clearCountTimer:function(){this.isNot=!1,clearInterval(this.countTimer),r.text("获取验证码")}},d={timer:0,show:function(t,n){$(t).text(n).fadeIn(200),this.hide(t,"")},hide:function(t,n){this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){$(t).fadeOut(200,function(){$(this).text(n)})},3e3)}};function t(){r.on("click",function(){var t;p.isNot||(t={mobile:i.value,originUrl:n("originUrl")},$.ajax({type:"post",url:o+"/api/dq/bjph/sendCode",data:t}).done(function(t){console.log("res",t),200===t.code?(p.countDown(60),h=t.data,d.show(e,"验证码已下发")):d.show(e,t.msg)}).fail(function(t){var n=JSON.parse(t.responseText);console.log("err",n),d.show(e,n.msg)}))});var t=new l;c.click(function(){t.add(i,e,[{strategy:"noEmpty",error:"请输入手机号"},{strategy:"isMobile",error:"手机号码有误，请重新输入"}]),t.add(s,e,[{strategy:"noEmpty",error:"请输入验证码"}]),t.check()&&a.fadeIn(300,function(){$("#x").text((h.X||"x")+"元"),$("#y").text((h.Y||"y")+"元"),$("#a").text((h.A||"A")+"G")})}),f.on("click",function(){var t={mobile:i.value,validCode:s.value,originUrl:n("originUrl")};a.fadeOut(300),$.ajax({type:"post",url:o+"/api/dq/bjph/saveOrders",data:t,success:function(t){console.log("res",t);var n=200===t.code?"订购成功！会员权益请在北京移动APP内领取":t.msg;d.show(e,n)},error:function(t){var n=JSON.parse(t.responseText);d.show(e,n.msg)}})}),u.on("click",function(){a.fadeOut(300)})}countLog.ready(function(){countLog.init(t,{isCopy:0,pageType:0})})});